<html>
<head>
<title>Traffic light controller.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Traffic light controller.py</font>
</center></td></tr></table>
<pre><span class="s0"># Import necessary libraries</span>
<span class="s2">import </span><span class="s1">serial</span>
<span class="s2">import </span><span class="s1">time</span>
<span class="s2">import </span><span class="s1">json</span>
<span class="s2">import </span><span class="s1">tkinter </span><span class="s2">as </span><span class="s1">tk</span>
<span class="s2">from </span><span class="s1">tkinter </span><span class="s2">import </span><span class="s1">messagebox</span>

<span class="s1">ser = </span><span class="s2">None</span>

<span class="s2">def </span><span class="s1">connect_arduino():</span>
    <span class="s2">global </span><span class="s1">ser</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">ser = serial.Serial(</span><span class="s3">&quot;COM5&quot;</span><span class="s1">, </span><span class="s4">9600</span><span class="s1">, timeout=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">time.sleep(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">messagebox.showinfo(</span><span class="s3">&quot;Connect&quot;</span><span class="s1">, </span><span class="s3">&quot;Arduino connection is successful!&quot;</span><span class="s1">)</span>
    <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">f&quot;Arduino connection is unsuccessful!: </span><span class="s5">{</span><span class="s1">e</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime, timedelta</span>

<span class="s2">def </span><span class="s1">calculate_duration():</span>
    <span class="s0"># Calculate Duration (Hours) from Time Frame and update to period_entries.</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">time_range = time_entries[i].get().strip()  </span><span class="s0"># Get input time frame</span>
            <span class="s1">start_time, end_time = time_range.split(</span><span class="s3">&quot;-&quot;</span><span class="s1">)  </span><span class="s0"># Split into 2 parts</span>
            <span class="s1">start_time = datetime.strptime(start_time.strip(), </span><span class="s3">&quot;%H:%M&quot;</span><span class="s1">)</span>
            <span class="s1">end_time = datetime.strptime(end_time.strip(), </span><span class="s3">&quot;%H:%M&quot;</span><span class="s1">)</span>

            <span class="s0"># Past midnight cases</span>
            <span class="s2">if </span><span class="s1">end_time &lt; start_time:</span>
                <span class="s1">end_time += timedelta(days=</span><span class="s4">1</span><span class="s1">)   </span><span class="s0"># Plus 24 hours</span>

            <span class="s0"># Calculate Duration (Hours) and round to 3 decimal places</span>
            <span class="s1">period_hours = (end_time - start_time).total_seconds() / </span><span class="s4">3600</span>

            <span class="s0"># Update to Duration (Hours)</span>
            <span class="s1">period_entries[i].delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
            <span class="s1">period_entries[i].insert(</span><span class="s4">0</span><span class="s1">, str(period_hours))</span>
        <span class="s2">except </span><span class="s1">Exception:</span>
            <span class="s1">period_entries[i].delete(</span><span class="s4">0</span><span class="s1">, tk.END)  </span><span class="s0"># If error then clear input field</span>

<span class="s2">def </span><span class="s1">calculate_blink_duration():</span>
    <span class="s0"># Calculate Duration (Hours) from the Time Frame in blink_period_entry.</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">time_range = blink_period_entry.get().strip()  </span><span class="s0"># Get input time frame</span>
        <span class="s1">start_time, end_time = time_range.split(</span><span class="s3">&quot;-&quot;</span><span class="s1">)  </span><span class="s0"># Split into 2 parts</span>
        <span class="s1">start_time = datetime.strptime(start_time.strip(), </span><span class="s3">&quot;%H:%M&quot;</span><span class="s1">)</span>
        <span class="s1">end_time = datetime.strptime(end_time.strip(), </span><span class="s3">&quot;%H:%M&quot;</span><span class="s1">)</span>

        <span class="s0"># Past midnight cases</span>
        <span class="s2">if </span><span class="s1">end_time &lt; start_time:</span>
            <span class="s1">end_time += timedelta(days=</span><span class="s4">1</span><span class="s1">)  </span><span class="s0"># Plus 24 hours</span>

        <span class="s0"># Calculate Duration (Hours) and round to 3 decimal places</span>
        <span class="s1">blink_hours = round((end_time - start_time).total_seconds() / </span><span class="s4">3600</span><span class="s1">, </span><span class="s4">3</span><span class="s1">)</span>

        <span class="s0"># Update to Duration (Hours)</span>
        <span class="s1">blink_period_hours_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
        <span class="s1">blink_period_hours_entry.insert(</span><span class="s4">0</span><span class="s1">, str(blink_hours))</span>
    <span class="s2">except </span><span class="s1">Exception:</span>
        <span class="s1">blink_period_hours_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)  </span><span class="s0"># If error then clear input field</span>

<span class="s0"># Calculate repeats using formula below</span>
<span class="s2">def </span><span class="s1">calculate_repeats():</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">green_time = int(green_entries[i].get())</span>
            <span class="s1">yellow_time = int(yellow_entries[i].get())</span>
            <span class="s1">red_time = int(red_entries[i].get())</span>
            <span class="s1">period_hours = float(period_entries[i].get())</span>

            <span class="s1">total_cycle_time = (green_time + </span><span class="s4">1</span><span class="s1">) + (yellow_time + </span><span class="s4">1</span><span class="s1">) + (red_time + </span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">total_period_seconds = period_hours * </span><span class="s4">3600</span>
            <span class="s1">repeats = round(total_period_seconds / total_cycle_time)</span>
            <span class="s1">calculated_repeat_entries[i].delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
            <span class="s1">calculated_repeat_entries[i].insert(</span><span class="s4">0</span><span class="s1">, str(repeats))</span>
        <span class="s2">except </span><span class="s1">ValueError:</span>
            <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">&quot;Please enter valid numbers for all fields!&quot;</span><span class="s1">)</span>

        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">blink_period = float(blink_period_hours_entry.get())</span>
            <span class="s1">repeats_blink = round(blink_period * </span><span class="s4">1800</span><span class="s1">)</span>
            <span class="s1">blink_repeat_calc_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
            <span class="s1">blink_repeat_calc_entry.insert(</span><span class="s4">0</span><span class="s1">, str(repeats_blink))</span>
        <span class="s2">except </span><span class="s1">ValueError:</span>
            <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">&quot; Please enter valid numbers for all fields!&quot;</span><span class="s1">)</span>

<span class="s0"># Calculate the deviation of the blinking yellow</span>
<span class="s2">def </span><span class="s1">calculate_blink_deviation():</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">blink_repeats = int(blink_repeat_entry.get())</span>
        <span class="s1">blink_period = float(blink_period_hours_entry.get())</span>
        <span class="s1">blink_deviation = (blink_repeats * </span><span class="s4">2</span><span class="s1">) - (blink_period * </span><span class="s4">3600</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">blink_deviation</span>
    <span class="s2">except </span><span class="s1">ValueError:</span>
        <span class="s2">return </span><span class="s4">0</span>

<span class="s0">#Calculate total deviation to check the deviation between the calculation cycle and the real time</span>
<span class="s2">def </span><span class="s1">calculate_total_deviation():</span>
    <span class="s1">total_deviation = </span><span class="s4">0</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">green_time = int(green_entries[i].get())</span>
            <span class="s1">yellow_time = int(yellow_entries[i].get())</span>
            <span class="s1">red_time = int(red_entries[i].get())</span>
            <span class="s1">repeats = int(manual_repeat_entries[i].get())</span>
            <span class="s1">period_hours = float(period_entries[i].get())</span>

            <span class="s1">total_cycle_time = (green_time + </span><span class="s4">1</span><span class="s1">) + (yellow_time + </span><span class="s4">1</span><span class="s1">) + (red_time + </span><span class="s4">1</span><span class="s1">)</span>
            <span class="s1">total_period_seconds = period_hours * </span><span class="s4">3600</span>
            <span class="s1">total_deviation += total_cycle_time * repeats - total_period_seconds</span>
        <span class="s2">except </span><span class="s1">ValueError:</span>
            <span class="s2">continue</span>
    <span class="s1">blink_deviation = calculate_blink_deviation()</span>
    <span class="s1">final_total_deviation = total_deviation + blink_deviation</span>
    <span class="s1">total_deviation_var.set(</span><span class="s3">f&quot;</span><span class="s5">{</span><span class="s1">round(final_total_deviation, </span><span class="s4">2</span><span class="s1">)</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s0"># Send data to Arduino</span>
<span class="s2">def </span><span class="s1">send_data():</span>
    <span class="s2">if </span><span class="s1">ser </span><span class="s2">and </span><span class="s1">ser.is_open:</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">data = </span><span class="s3">&quot;&quot;</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
                <span class="s1">green_time = green_entries[i].get()</span>
                <span class="s1">yellow_time = yellow_entries[i].get()</span>
                <span class="s1">red_time = red_entries[i].get()</span>
                <span class="s1">repeat_count = manual_repeat_entries[i].get()</span>
                <span class="s1">data += </span><span class="s3">f&quot;</span><span class="s5">{</span><span class="s1">green_time</span><span class="s5">}</span><span class="s3">,</span><span class="s5">{</span><span class="s1">yellow_time</span><span class="s5">}</span><span class="s3">,</span><span class="s5">{</span><span class="s1">red_time</span><span class="s5">}</span><span class="s3">,</span><span class="s5">{</span><span class="s1">repeat_count</span><span class="s5">}</span><span class="s3">,&quot;</span>
            <span class="s1">repeat_count_blink = blink_repeat_entry.get()</span>
            <span class="s1">blink_period = blink_period_entry.get()</span>
            <span class="s1">data += </span><span class="s3">f&quot;</span><span class="s5">{</span><span class="s1">repeat_count_blink</span><span class="s5">}</span><span class="s3">,</span><span class="s5">{</span><span class="s1">blink_period</span><span class="s5">}\n</span><span class="s3">&quot;</span>
            <span class="s1">ser.write(data.encode())</span>
            <span class="s1">print(</span><span class="s3">&quot;Data submitted:&quot;</span><span class="s1">, data.strip())  </span><span class="s0"># Print in terminal</span>

            <span class="s0"># Wait for Arduino to respond and print to PyCharm terminal</span>
            <span class="s1">time.sleep(</span><span class="s4">1</span><span class="s1">)  </span><span class="s0"># Give Arduino time to process</span>
            <span class="s2">while </span><span class="s1">ser.in_waiting:</span>
                <span class="s1">response = ser.readline().decode(errors=</span><span class="s3">'ignore'</span><span class="s1">).strip()</span>
                <span class="s1">print(</span><span class="s3">&quot;Arduino response:&quot;</span><span class="s1">, response)</span>
            <span class="s1">messagebox.showinfo(</span><span class="s3">&quot;Send data&quot;</span><span class="s1">, </span><span class="s3">&quot;Data sent successfully!&quot;</span><span class="s1">)</span>
        <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e:</span>
            <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">f&quot;Unable to send data: </span><span class="s5">{</span><span class="s1">e</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">&quot;Arduino is not connected!&quot;</span><span class="s1">)</span>

<span class="s2">def </span><span class="s1">calculate_all_durations():    </span><span class="s0"># For calculating all durations</span>
    <span class="s1">calculate_duration()</span>
    <span class="s1">calculate_blink_duration()</span>
    <span class="s1">calculate_total_deviation()</span>

<span class="s2">def </span><span class="s1">save_data_to_file():          </span><span class="s0"># Save data to file JSON</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">data = {</span>
            <span class="s3">&quot;time_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">time_entries],</span>
            <span class="s3">&quot;period_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">period_entries],</span>
            <span class="s3">&quot;green_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">green_entries],</span>
            <span class="s3">&quot;yellow_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">yellow_entries],</span>
            <span class="s3">&quot;red_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">red_entries],</span>
            <span class="s3">&quot;calculated_repeat_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">calculated_repeat_entries],</span>
            <span class="s3">&quot;manual_repeat_entries&quot;</span><span class="s1">: [entry.get() </span><span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">manual_repeat_entries],</span>
            <span class="s3">&quot;total_deviation&quot;</span><span class="s1">: total_deviation_var.get(),</span>
            <span class="s3">&quot;blink&quot;</span><span class="s1">: {</span>
                <span class="s3">&quot;blink_period_entry&quot;</span><span class="s1">: blink_period_entry.get(),</span>
                <span class="s3">&quot;blink_period_hours_entry&quot;</span><span class="s1">: blink_period_hours_entry.get(),</span>
                <span class="s3">&quot;blink_repeat_calc_entry&quot;</span><span class="s1">: blink_repeat_calc_entry.get(),</span>
                <span class="s3">&quot;blink_repeat_entry&quot;</span><span class="s1">: blink_repeat_entry.get()</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">with </span><span class="s1">open(</span><span class="s3">&quot;traffic_light_data.json&quot;</span><span class="s1">, </span><span class="s3">&quot;w&quot;</span><span class="s1">, encoding=</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">f:</span>
            <span class="s1">json.dump(data, f, indent=</span><span class="s4">4</span><span class="s1">, ensure_ascii=</span><span class="s2">False</span><span class="s1">)</span>
        <span class="s1">messagebox.showinfo(</span><span class="s3">&quot;Save data&quot;</span><span class="s1">, </span><span class="s3">&quot;Data has been saved!&quot;</span><span class="s1">)</span>
    <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">f&quot;Unable to save data: </span><span class="s5">{</span><span class="s1">e</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s2">def </span><span class="s1">load_data_from_file():  </span><span class="s0"># Load data from file</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s2">with </span><span class="s1">open(</span><span class="s3">&quot;traffic_light_data.json&quot;</span><span class="s1">, </span><span class="s3">&quot;r&quot;</span><span class="s1">, encoding=</span><span class="s3">&quot;utf-8&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">f:</span>
            <span class="s1">data = json.load(f)</span>
        <span class="s2">for </span><span class="s1">entries, values </span><span class="s2">in </span><span class="s1">[</span>
            <span class="s1">(time_entries, data.get(</span><span class="s3">&quot;time_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(period_entries, data.get(</span><span class="s3">&quot;period_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(green_entries, data.get(</span><span class="s3">&quot;green_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(yellow_entries, data.get(</span><span class="s3">&quot;yellow_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(red_entries, data.get(</span><span class="s3">&quot;red_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(calculated_repeat_entries, data.get(</span><span class="s3">&quot;calculated_repeat_entries&quot;</span><span class="s1">, [])),</span>
            <span class="s1">(manual_repeat_entries, data.get(</span><span class="s3">&quot;manual_repeat_entries&quot;</span><span class="s1">, []))</span>
        <span class="s1">]:</span>
            <span class="s2">for </span><span class="s1">entry, value </span><span class="s2">in </span><span class="s1">zip(entries, values):</span>
                <span class="s1">entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
                <span class="s1">entry.insert(</span><span class="s4">0</span><span class="s1">, value)</span>

        <span class="s1">blink_data = data.get(</span><span class="s3">&quot;blink&quot;</span><span class="s1">, {})</span>
        <span class="s1">blink_period_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
        <span class="s1">blink_period_entry.insert(</span><span class="s4">0</span><span class="s1">, blink_data.get(</span><span class="s3">&quot;blink_period_entry&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">blink_period_hours_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
        <span class="s1">blink_period_hours_entry.insert(</span><span class="s4">0</span><span class="s1">, blink_data.get(</span><span class="s3">&quot;blink_period_hours_entry&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">blink_repeat_calc_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
        <span class="s1">blink_repeat_calc_entry.insert(</span><span class="s4">0</span><span class="s1">, blink_data.get(</span><span class="s3">&quot;blink_repeat_calc_entry&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">blink_repeat_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
        <span class="s1">blink_repeat_entry.insert(</span><span class="s4">0</span><span class="s1">, blink_data.get(</span><span class="s3">&quot;blink_repeat_entry&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">))</span>

        <span class="s1">total_deviation_var.set(data.get(</span><span class="s3">&quot;total_deviation&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">))</span>
    <span class="s2">except </span><span class="s1">FileNotFoundError:</span>
        <span class="s2">pass  </span><span class="s0"># If there is no file, skip it.</span>
    <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">messagebox.showerror(</span><span class="s3">&quot;Error&quot;</span><span class="s1">, </span><span class="s3">f&quot;Unable to load saved data: </span><span class="s5">{</span><span class="s1">e</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s2">def </span><span class="s1">reset_fields():</span>
    <span class="s0"># Do not reset time_entries and blink_period_entry</span>
    <span class="s2">for </span><span class="s1">entry_list </span><span class="s2">in </span><span class="s1">[period_entries, green_entries, yellow_entries, red_entries, calculated_repeat_entries, manual_repeat_entries]:</span>
        <span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">entry_list:</span>
            <span class="s1">entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
    <span class="s1">blink_period_hours_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
    <span class="s1">blink_repeat_calc_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
    <span class="s1">blink_repeat_entry.delete(</span><span class="s4">0</span><span class="s1">, tk.END)</span>
    <span class="s1">total_deviation_var.set(</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
    <span class="s1">messagebox.showinfo(</span><span class="s3">&quot;Reset data&quot;</span><span class="s1">, </span><span class="s3">&quot;Data has been reset (except time frame).&quot;</span><span class="s1">)</span>

<span class="s0"># Tkinter Interface</span>
<span class="s1">root = tk.Tk()</span>
<span class="s1">root.title(</span><span class="s3">&quot;Traffic light controller&quot;</span><span class="s1">)</span>
<span class="s1">root.resizable(</span><span class="s2">True</span><span class="s1">, </span><span class="s2">True</span><span class="s1">)</span>

<span class="s0"># Get screen size</span>
<span class="s1">screen_width = root.winfo_screenwidth()</span>
<span class="s1">screen_height = root.winfo_screenheight()</span>

<span class="s0"># Get window size</span>
<span class="s1">window_width = </span><span class="s4">1275</span>
<span class="s1">window_height = </span><span class="s4">650</span>

<span class="s0"># Set window position at the center or middle of the screen</span>
<span class="s1">position_x = (screen_width - window_width) // </span><span class="s4">2 </span><span class="s1">- </span><span class="s4">5</span>
<span class="s1">position_y = (screen_height - window_height) // </span><span class="s4">2 </span><span class="s1">- </span><span class="s4">35</span>
<span class="s1">root.geometry(</span><span class="s3">f&quot;</span><span class="s5">{</span><span class="s1">window_width</span><span class="s5">}</span><span class="s3">x</span><span class="s5">{</span><span class="s1">window_height</span><span class="s5">}</span><span class="s3">+</span><span class="s5">{</span><span class="s1">position_x</span><span class="s5">}</span><span class="s3">+</span><span class="s5">{</span><span class="s1">position_y</span><span class="s5">}</span><span class="s3">&quot;</span><span class="s1">)</span>
<span class="s1">root.update_idletasks()</span>

<span class="s0"># Title and Serial Port</span>
<span class="s1">tk.Label(root, text=</span><span class="s3">&quot;TRAFFIC LIGHT CONTROLLER&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">16</span><span class="s1">, </span><span class="s3">&quot;bold&quot;</span><span class="s1">)).pack(pady=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s1">tk.Label(root, text=</span><span class="s3">&quot;Serial Port: COM5&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).pack()</span>

<span class="s1">frame_main = tk.Frame(root)</span>
<span class="s1">frame_main.pack(pady=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s0"># Label and fields data</span>
<span class="s1">frames = [</span>
    <span class="s3">&quot;5:00 - 6:30&quot;</span><span class="s1">, </span><span class="s3">&quot;6:30 - 9:00&quot;</span><span class="s1">, </span><span class="s3">&quot;09:00 - 11:30&quot;</span><span class="s1">, </span><span class="s3">&quot;11:30 - 13:30&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;13:30 - 16:00&quot;</span><span class="s1">, </span><span class="s3">&quot;16:30 - 19:30&quot;</span><span class="s1">, </span><span class="s3">&quot;19:30 - 22:00&quot;</span><span class="s1">, </span><span class="s3">&quot;22:00 - 5:00&quot;</span>
<span class="s1">]</span>

<span class="s1">columns = [</span><span class="s3">&quot;Time Frame&quot;</span><span class="s1">, </span><span class="s3">&quot;Duration (Hours)&quot;</span><span class="s1">, </span><span class="s3">&quot;Green (Seconds)&quot;</span><span class="s1">, </span><span class="s3">&quot;Yellow (Seconds)&quot;</span><span class="s1">, </span><span class="s3">&quot;Red (Seconds)&quot;</span><span class="s1">, </span><span class="s3">&quot;Repeats (Calculated)&quot;</span><span class="s1">, </span><span class="s3">&quot;Repeats (Manual Input)&quot;</span><span class="s1">]</span>

<span class="s1">tk.Label(frame_main, text=</span><span class="s3">&quot;Time Frame&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=</span><span class="s4">0</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">)</span>

<span class="s1">time_entries = []</span>
<span class="s2">for </span><span class="s1">i, frame </span><span class="s2">in </span><span class="s1">enumerate(frames):</span>
    <span class="s1">entry = tk.Entry(frame_main, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
    <span class="s1">entry.insert(</span><span class="s4">0</span><span class="s1">, frame)</span>
    <span class="s1">entry.grid(row=</span><span class="s4">0</span><span class="s1">, column=i+</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">time_entries.append(entry)</span>

<span class="s0"># Input fields include durations (hours), time for each light and number of repeats</span>
<span class="s1">green_entries, yellow_entries, red_entries, calculated_repeat_entries, manual_repeat_entries, period_entries = [], [], [], [], [], []</span>
<span class="s2">for </span><span class="s1">row, column_name </span><span class="s2">in </span><span class="s1">enumerate(columns[</span><span class="s4">1</span><span class="s1">:]):</span>
    <span class="s1">tk.Label(frame_main, text=column_name, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=row+</span><span class="s4">1</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, pady=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">col </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
        <span class="s1">entry = tk.Entry(frame_main, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
        <span class="s1">entry.grid(row=row+</span><span class="s4">1</span><span class="s1">, column=col+</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s2">if </span><span class="s1">row == </span><span class="s4">0</span><span class="s1">:</span>
            <span class="s1">period_entries.append(entry)</span>
        <span class="s2">elif </span><span class="s1">row == </span><span class="s4">1</span><span class="s1">:</span>
            <span class="s1">green_entries.append(entry)</span>
        <span class="s2">elif </span><span class="s1">row == </span><span class="s4">2</span><span class="s1">:</span>
            <span class="s1">yellow_entries.append(entry)</span>
        <span class="s2">elif </span><span class="s1">row == </span><span class="s4">3</span><span class="s1">:</span>
            <span class="s1">red_entries.append(entry)</span>
        <span class="s2">elif </span><span class="s1">row == </span><span class="s4">4</span><span class="s1">:</span>
            <span class="s1">calculated_repeat_entries.append(entry)</span>
        <span class="s2">elif </span><span class="s1">row == </span><span class="s4">5</span><span class="s1">:</span>
            <span class="s1">manual_repeat_entries.append(entry)</span>

<span class="s0"># Blinking yellow night mode</span>
<span class="s1">frame_blink = tk.Frame(root)</span>
<span class="s1">frame_blink.pack(pady=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s0"># Label (Move to left column)</span>
<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Night mode (Blinking Yellow)&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">, </span><span class="s3">&quot;bold&quot;</span><span class="s1">)).grid(row=</span><span class="s4">0</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, columnspan=</span><span class="s4">2</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">, pady=(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">10</span><span class="s1">))</span>

<span class="s0"># Right column: Step-by-step instructions (move up 1 line + space further apart)</span>
<span class="s1">instructions = [</span>
    <span class="s3">&quot;Step 1: Adjust the time frame               Step 2: Select 'Calculate Time'&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 3: Enter the time for each green, yellow, red light&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 4: Select 'Calculate Repeats'&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 5: Re-enter the calculated repeats in 'Repeats (Manual Input)' (Adjustable for testing)&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 6: Select 'Calculate Deviation'&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 7: Adjust the Repeats (Manual Input) to minimize the deviation&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;Step 8: Connect and send data to the Arduino (Save the results if needed)&quot;</span>
<span class="s1">]</span>

<span class="s2">for </span><span class="s1">i, step </span><span class="s2">in </span><span class="s1">enumerate(instructions, start=</span><span class="s4">0</span><span class="s1">):  </span><span class="s0"># Start from row=0 instead of row=1</span>
    <span class="s1">tk.Label(frame_blink, text=step, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">11</span><span class="s1">)).grid(row=i, column=</span><span class="s4">4</span><span class="s1">, padx=</span><span class="s4">130</span><span class="s1">, pady=</span><span class="s4">5</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)  </span><span class="s0"># Spacing by padx=160</span>

<span class="s0"># Left column: Input parameters including time frame, duration and repeats</span>
<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Time Frame&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=</span><span class="s4">1</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)</span>
<span class="s1">blink_period_entry = tk.Entry(frame_blink, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
<span class="s1">blink_period_entry.grid(row=</span><span class="s4">1</span><span class="s1">, column=</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">, pady=</span><span class="s4">7</span><span class="s1">)</span>
<span class="s1">blink_period_entry.insert(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">&quot;22:00 - 5:00&quot;</span><span class="s1">)</span>

<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Duration (Hours)&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=</span><span class="s4">2</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)</span>
<span class="s1">blink_period_hours_entry = tk.Entry(frame_blink, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
<span class="s1">blink_period_hours_entry.grid(row=</span><span class="s4">2</span><span class="s1">, column=</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">, pady=</span><span class="s4">7</span><span class="s1">)</span>

<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Repeats (Calculated)&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=</span><span class="s4">3</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)</span>
<span class="s1">blink_repeat_calc_entry = tk.Entry(frame_blink, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
<span class="s1">blink_repeat_calc_entry.grid(row=</span><span class="s4">3</span><span class="s1">, column=</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">, pady=</span><span class="s4">7</span><span class="s1">)</span>

<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Repeats (Manual Input)&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">)).grid(row=</span><span class="s4">4</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)</span>
<span class="s1">blink_repeat_entry = tk.Entry(frame_blink, width=</span><span class="s4">12</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">))</span>
<span class="s1">blink_repeat_entry.grid(row=</span><span class="s4">4</span><span class="s1">, column=</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">, pady=</span><span class="s4">7</span><span class="s1">)</span>

<span class="s0"># Total deviation label and entry</span>
<span class="s1">total_deviation_var = tk.StringVar()</span>
<span class="s1">tk.Label(frame_blink, text=</span><span class="s3">&quot;Total deviation (Seconds)&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">, </span><span class="s3">&quot;bold&quot;</span><span class="s1">)).grid(row=</span><span class="s4">5</span><span class="s1">, column=</span><span class="s4">0</span><span class="s1">, sticky=</span><span class="s3">&quot;w&quot;</span><span class="s1">)</span>
<span class="s1">total_deviation_entry = tk.Entry(frame_blink, textvariable=total_deviation_var, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">12</span><span class="s1">), width=</span><span class="s4">12</span><span class="s1">, bg=</span><span class="s3">&quot;white&quot;</span><span class="s1">)</span>
<span class="s1">total_deviation_entry.grid(row=</span><span class="s4">5</span><span class="s1">, column=</span><span class="s4">1</span><span class="s1">, padx=</span><span class="s4">10</span><span class="s1">, pady=</span><span class="s4">7</span><span class="s1">)</span>

<span class="s0"># Function buttons</span>
<span class="s1">frame_buttons = tk.Frame(root)</span>
<span class="s1">frame_buttons.pack(pady=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Calculate Time&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=calculate_all_durations).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Calculate Repeats&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=</span><span class="s2">lambda</span><span class="s1">: [calculate_repeats()]).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Calculate Deviation&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=calculate_total_deviation).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Connect&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=connect_arduino).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Send data&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=send_data).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Reset data&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=reset_fields).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">tk.Button(frame_buttons, text=</span><span class="s3">&quot;Save data&quot;</span><span class="s1">, font=(</span><span class="s3">&quot;Arial&quot;</span><span class="s1">, </span><span class="s4">13</span><span class="s1">), command=save_data_to_file).pack(side=tk.LEFT, padx=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s1">load_data_from_file()</span>

<span class="s1">root.mainloop()</span>
</pre>
</body>
</html>